<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>NumberStatistics.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">PMDB</a> &gt; <a href="index.source.html" class="el_package">org.xandercat.pmdb.util</a> &gt; <span class="el_source">NumberStatistics.java</span></div><h1>NumberStatistics.java</h1><pre class="source lang-java linenums">package org.xandercat.pmdb.util;

import java.util.List;

/**
 * Statistics for numbers.  This class expects the list of numbers to be non-null, contain no null values, and have a size of at least 1.
 * 
 * Standard deviation and interquartile range are lazy calculated when needed.
 * 
 * @author Scott Arnold
 */
public abstract class NumberStatistics&lt;T extends Number&gt; {

	public static final double IQR_MULTIPLIER = 1.5;  // standard multiplier for finding outliers using IQR
	
	private List&lt;T&gt; values;
	private Double standardDeviation;
	private Double interquartileRange;
	private Double iqrQ1;
	private Double iqrQ3;
	
	/**
	 * Construct statistics for the provided list of values.
	 * 
	 * @param values  double values
	 */
<span class="fc" id="L27">	public NumberStatistics(List&lt;T&gt; values) {</span>
<span class="pc bpc" id="L28" title="2 of 4 branches missed.">		if (values == null || values.size() &lt; 1) {</span>
<span class="nc" id="L29">			throw new IllegalArgumentException(&quot;List of values must be non null and contain at least 1 value.&quot;);</span>
		}
<span class="fc" id="L31">		this.values = values;</span>
<span class="fc" id="L32">		sort(values);</span>
<span class="fc" id="L33">	}</span>

	/**
	 * Sorts the list of values in natural order.
	 * 
	 * @param values values to sort
	 */
	protected abstract void sort(List&lt;T&gt; values);
	
	/**
	 * Return number parsed from given string.  If value cannot be parsed, null should be returned.
	 * 
	 * @param value value to parse
	 * 
	 * @return parsed value
	 */
	protected abstract T parse(String value);
	
	/**
	 * Returns the minimum number from the list of numbers.
	 * 
	 * @return minimum
	 */
	public abstract T getMin();
	
	/**
	 * Returns the maximum number from the list of numbers.
	 * 
	 * @return maximum
	 */
	public abstract T getMax();
	
	/**
	 * Returns the average from the list of numbers.
	 * 
	 * @return average
	 */
	public abstract double getAverage();
	
	/**
	 * Returns median value from list of numbers.  Returned number is a double due to
	 * rule of taking average of two middle values for a list with an even quantity of numbers.
	 * 
	 * @return median value
	 */
	public double getMedian() {
<span class="fc" id="L79">		return calculateMedian(values);</span>
	}
	
	/**
	 * Returns standard deviation from list of numbers.
	 * 
	 * @return standard deviation
	 */
	public double getStandardDeviation() {
<span class="pc bpc" id="L88" title="1 of 2 branches missed.">		if (standardDeviation == null) {</span>
<span class="fc" id="L89">			calculateStandardDeviation();</span>
		}
<span class="fc" id="L91">		return standardDeviation;</span>
	}
	
	/**
	 * Returns interquartile range from list of numbers.
	 * 
	 * @return interquartile range
	 */
	public double getInterquartileRange() {
<span class="fc bfc" id="L100" title="All 2 branches covered.">		if (interquartileRange == null) {</span>
<span class="fc" id="L101">			calculateInterquartileRange();</span>
		}
<span class="fc" id="L103">		return interquartileRange;</span>
	}
	
	/**
	 * Returns whether or not the provided value is an outlier from the list of doubles using the 1.5xIQR rule.
	 * If the value cannot be parsed, it is considered an outlier.
	 * 
	 * @param value value to test
	 * 
	 * @return whether or not value is an outlier as compared to the internal list of numbers.
	 */
	public boolean isOutlier(String value) {
<span class="nc" id="L115">		T parsedValue = parse(value);</span>
<span class="nc bnc" id="L116" title="All 4 branches missed.">		return (parsedValue == null || isOutlier(parsedValue));</span>
	}
	
	/**
	 * Returns whether or not the provided value is an outlier from the list of numbers using the 1.5xIQR rule.
	 * 
	 * @param value value to test
	 * 
	 * @return whether or not value is an outlier as compared to the internal list of numbers.
	 */
	public boolean isOutlier(T value) {
<span class="fc bfc" id="L127" title="All 4 branches covered.">		return isHighOutlier(value) || isLowOutlier(value);</span>
	}

	/**
	 * Returns whether or not the provided value is an outlier on the high end from the list of numbers using the 1.5xIQR rule.
	 * If the value cannot be parsed, it is considered an outlier.
	 * 
	 * @param value value to test
	 * 
	 * @return whether or not value is an outlier on the high end as compared to the internal list of numbers.
	 */
	public boolean isHighOutlier(String value) {
<span class="nc" id="L139">		T parsedValue = parse(value);</span>
<span class="nc bnc" id="L140" title="All 4 branches missed.">		return (parsedValue == null || isHighOutlier(parsedValue));</span>
	}

	/**
	 * Returns whether or not the provided value is an outlier on the high end from the list of numbers using the 1.5xIQR rule.
	 * If the value is null, it is considered an outlier.
	 * 
	 * @param value value to test
	 * 
	 * @return whether or not value is an outlier on the high end as compared to the internal list of numbers.
	 */
	public boolean isHighOutlier(T value) {
<span class="pc bpc" id="L152" title="1 of 2 branches missed.">		if (value == null) {</span>
<span class="nc" id="L153">			return true;</span>
		}
<span class="fc" id="L155">		double iqr = getInterquartileRange();</span>
<span class="fc bfc" id="L156" title="All 2 branches covered.">		return (value.doubleValue() &gt; (iqrQ3 + IQR_MULTIPLIER * iqr));</span>
	}
	
	/**
	 * Returns whether or not the provided value is an outlier on the low end from the list of numbers using the 1.5xIQR rule.
	 * If the value cannot be parsed, it is considered an outlier.
	 * 
	 * @param value value to test
	 * 
	 * @return whether or not value is an outlier on the low end as compared to the internal list of numbers.
	 */
	public boolean isLowOutlier(String value) {
<span class="nc" id="L168">		T parsedValue = parse(value);</span>
<span class="nc bnc" id="L169" title="All 4 branches missed.">		return (parsedValue == null || isLowOutlier(parsedValue));</span>
	}
	
	/**
	 * Returns whether or not the provided value is an outlier on the low end from the list of numbers using the 1.5xIQR rule.
	 * If the value is null, it is considered an outlier.
	 * 
	 * @param value value to test
	 * 
	 * @return whether or not value is an outlier on the low end as compared to the internal list of numbers.
	 */
	public boolean isLowOutlier(T value) {
<span class="pc bpc" id="L181" title="1 of 2 branches missed.">		if (value == null) {</span>
<span class="nc" id="L182">			return true;</span>
		}
<span class="fc" id="L184">		double iqr = getInterquartileRange();</span>
<span class="fc bfc" id="L185" title="All 2 branches covered.">		return (value.doubleValue() &lt; (iqrQ1 - IQR_MULTIPLIER * iqr));</span>
	}
	
	private void calculateStandardDeviation() {
<span class="fc" id="L189">		double intermediateSum = 0;</span>
<span class="fc" id="L190">		double average = getAverage();</span>
<span class="fc bfc" id="L191" title="All 2 branches covered.">		for (Number value : values) {</span>
<span class="fc" id="L192">			intermediateSum += Math.pow(value.doubleValue() - average, 2);</span>
<span class="fc" id="L193">		}</span>
<span class="fc" id="L194">		this.standardDeviation = Math.sqrt(intermediateSum / (double) values.size());</span>
<span class="fc" id="L195">	}</span>
	
	private void calculateInterquartileRange() {
<span class="fc bfc" id="L198" title="All 2 branches covered.">		if (values.size() == 1) {</span>
<span class="fc" id="L199">			this.iqrQ1 = values.get(0).doubleValue();</span>
<span class="fc" id="L200">			this.iqrQ3 = values.get(0).doubleValue();</span>
		} else {
<span class="fc" id="L202">			int midpoint = values.size() / 2;</span>
<span class="fc" id="L203">			List&lt;T&gt; lowerHalf = values.subList(0, midpoint);</span>
<span class="fc" id="L204">			List&lt;T&gt; upperHalf = values.subList(midpoint+(values.size() % 2), values.size());</span>
<span class="fc" id="L205">			this.iqrQ1 = calculateMedian(lowerHalf);</span>
<span class="fc" id="L206">			this.iqrQ3 = calculateMedian(upperHalf);</span>
		}
<span class="fc" id="L208">		this.interquartileRange = iqrQ3 - iqrQ1;</span>
<span class="fc" id="L209">	}</span>
	
	private double calculateMedian(List&lt;T&gt; values) {
<span class="fc" id="L212">		int midpointIndex = values.size() / 2;</span>
<span class="fc bfc" id="L213" title="All 2 branches covered.">		if (values.size() % 2 == 0) {</span>
<span class="fc" id="L214">			return (values.get(midpointIndex -1).doubleValue() + values.get(midpointIndex).doubleValue()) / 2d;</span>
		} else {
<span class="fc" id="L216">			return values.get(midpointIndex).doubleValue();</span>
		}
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>